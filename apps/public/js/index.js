// Generated by CoffeeScript 1.3.3
var index;

index = {
  view: {},
  skelton: {},
  cnt: 0,
  folders: [],
  cntFolders: 0,
  scrollTop: 0,
  init: function() {
    index.view = $('#Index');
    index.skelton = $('#Index > #skelton');
    $(window).scroll(index.getOne);
    return $(window).resize(index.getOne);
  },
  display: function() {
    return $('#LoginForm').show(); 
    location.hash = '';
    index.view.show();
    $(window).scrollTop(index.scrollTop);
    if (index.cntFolders === 0) {
      /*"/folder/search.json", function(res) {
        index.cntFolders = res.count;
        return index.skelton.fadeIn(function() {
          return index.getOne();
        );
      }}*/
    }
  },
  hidden: function() {
    return index.view.hide();
  },
  getOne_process: false,
  getOne: function() {
    var contentBottom, scrollBottom;
    if ((index.view.css('display')) !== 'block') {
      return;
    }
    if (index.getOne_process) {
      return;
    }
    contentBottom = index.skelton.offset().top;
    scrollBottom = $(window).height() + $(window).scrollTop() + $('footer').height() + 10;
    if (contentBottom <= scrollBottom) {
      index.getOne_process = true;
      return app.get("/folder/getOne.json?f=" + index.cnt, function(res) {
        var $item, folder, hash;
        index.cnt++;
        index.getOne_process = false;
        folder = res.folder;
        if (folder.name != null) {
          index.folders[folder.name] = folder;
          $item = index.skelton.clone();
          $item.removeAttr('id').hide();
          $item.append($('<div />').addClass('thumbnail').css('background-image', 'url("/img/file.png")'));
          hash = "#" + folder.name;
          $item.click(index.click(hash));
          $item.append("<h4>" + folder.name + "</h4>");
          $item.ready(function() {
            $item.fadeIn();
            return index.getOne();
          });
          return index.skelton.before($item);
        }
      });
    }
  },
  click: function(hash) {
    return function(e) {
      e.preventDefault();
      index.scrollTop = $(window).scrollTop();
      location.hash = hash;
      return view.show(detail);
    };
  }
};

view.list.push(index);
